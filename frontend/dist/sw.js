!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=9)}({8:function(e,t,n){"use strict";!function(){function t(e){return new Promise(function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function n(e,n,r){var o,i=new Promise(function(i,u){t(o=e[n].apply(e,r)).then(i,u)});return i.request=o,i}function r(e,t,n){n.forEach(function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})})}function o(e,t,r,o){o.forEach(function(o){o in r.prototype&&(e.prototype[o]=function(){return n(this[t],o,arguments)})})}function i(e,t,n,r){r.forEach(function(r){r in n.prototype&&(e.prototype[r]=function(){return this[t][r].apply(this[t],arguments)})})}function u(e,t,r,o){o.forEach(function(o){o in r.prototype&&(e.prototype[o]=function(){return e=this[t],(r=n(e,o,arguments)).then(function(e){if(e)return new s(e,r.request)});var e,r})})}function c(e){this._index=e}function s(e,t){this._cursor=e,this._request=t}function a(e){this._store=e}function l(e){this._tx=e,this.complete=new Promise(function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}})}function p(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new l(n)}function f(e){this._db=e}r(c,"_index",["name","keyPath","multiEntry","unique"]),o(c,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),u(c,"_index",IDBIndex,["openCursor","openKeyCursor"]),r(s,"_cursor",["direction","key","primaryKey","value"]),o(s,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(e){e in IDBCursor.prototype&&(s.prototype[e]=function(){var n=this,r=arguments;return Promise.resolve().then(function(){return n._cursor[e].apply(n._cursor,r),t(n._request).then(function(e){if(e)return new s(e,n._request)})})})}),a.prototype.createIndex=function(){return new c(this._store.createIndex.apply(this._store,arguments))},a.prototype.index=function(){return new c(this._store.index.apply(this._store,arguments))},r(a,"_store",["name","keyPath","indexNames","autoIncrement"]),o(a,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),u(a,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),i(a,"_store",IDBObjectStore,["deleteIndex"]),l.prototype.objectStore=function(){return new a(this._tx.objectStore.apply(this._tx,arguments))},r(l,"_tx",["objectStoreNames","mode"]),i(l,"_tx",IDBTransaction,["abort"]),p.prototype.createObjectStore=function(){return new a(this._db.createObjectStore.apply(this._db,arguments))},r(p,"_db",["name","version","objectStoreNames"]),i(p,"_db",IDBDatabase,["deleteObjectStore","close"]),f.prototype.transaction=function(){return new l(this._db.transaction.apply(this._db,arguments))},r(f,"_db",["name","version","objectStoreNames"]),i(f,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[a,c].forEach(function(t){e in t.prototype&&(t.prototype[e.replace("open","iterate")]=function(){var t,n=(t=arguments,Array.prototype.slice.call(t)),r=n[n.length-1],o=this._store||this._index,i=o[e].apply(o,n.slice(0,-1));i.onsuccess=function(){r(i.result)}})})}),[c,a].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,r=[];return new Promise(function(o){n.iterateCursor(e,function(e){e?(r.push(e.value),void 0===t||r.length!=t?e.continue():o(r)):o(r)})})})});var h={open:function(e,t,r){var o=n(indexedDB,"open",[e,t]),i=o.request;return i&&(i.onupgradeneeded=function(e){r&&r(new p(i.result,e.oldVersion,i.transaction))}),o.then(function(e){return new f(e)})},delete:function(e){return n(indexedDB,"deleteDatabase",[e])}};e.exports=h,e.exports.default=e.exports}()},9:function(e,t,n){"use strict";n.r(t);var r=n(8);const o="restaurant-images-v1",i="restaurant-map-v1",u=["restaurant-reviews-v1",o,i],c=["/index.html","/restaurant.html","/restaurant.bundle.js","/main.bundle.js"];var s=n.n(r).a.open("restaurant-reviews",1,function(e){e.createObjectStore("restaurants")});const a={get:e=>s.then(t=>t.transaction("restaurants").objectStore("restaurants").get(e)),set:(e,t)=>s.then(n=>{const r=n.transaction("restaurants","readwrite");return r.objectStore("restaurants").put(t,e),r.complete}),delete:e=>s.then(t=>{const n=t.transaction("restaurants","readwrite");return n.objectStore("restaurants").delete(e),n.complete}),clear:()=>s.then(e=>{const t=e.transaction("restaurants","readwrite");return t.objectStore("restaurants").clear(),t.complete}),keys:()=>s.then(e=>{const t=e.transaction("restaurants"),n=[],r=t.objectStore("restaurants");return(r.iterateKeyCursor||r.iterateCursor).call(r,e=>{e&&(n.push(e.key),e.continue())}),t.complete.then(()=>n)})};self.addEventListener("install",function(e){console.log("ServiceWorker installed"),e.waitUntil(caches.open("restaurant-reviews-v1").then(function(e){return e.addAll(c)}).catch(function(e){console.log("Error has occured: ",e)}))}),self.addEventListener("activate",function(e){e.waitUntil(caches.keys().then(function(e){return Promise.all(e.filter(function(e){return e.startsWith("restaurant-")&&!u.includes(e)}).map(function(e){return caches.delete(e)}))}))}),self.addEventListener("fetch",function(e){let t=new URL(e.request.url);if(t.origin===location.origin){if("/"===t.pathname)return console.log("Serving cached index page"),void e.respondWith(caches.match("/index.html"));if("/restaurant.html"===t.pathname)return console.log("Serving restraunt page"),void e.respondWith(caches.match("/restaurant.html"));if(t.pathname.startsWith("/img/"))return console.log("Image requested, checking cache"),void e.respondWith(function(e){const t=e.url.replace(/-\d+px\.jpg$/,"");return caches.open(o).then(function(n){return n.match(t).then(function(r){return r||fetch(e).then(function(e){return n.put(t,e.clone()),e})})})}(e.request));if(t.pathname.startsWith("/maps/api/js"))return console.log("Map requested, checking cache"),void e.respondWith((n=e.request,caches.open(i).then(function(e){return e.match("map").then(function(t){return t||fetch(n,{mode:"no-cors"}).then(function(t){return e.put("map",t.clone()),t})})})))}var n,r;"/restaurants"!==t.pathname?e.respondWith(caches.match(e.request).then(function(t){return t||fetch(e.request)})):e.respondWith((r=e.request,a.get("restaurants-json").then(function(e){return e?(console.log("IndexDB JSON Found"),new Response(JSON.stringify(e))):(console.log("IndexDB Empty Returning Fetch"),fetch(r).then(function(e){let t=e.clone();return t.json().then(function(e){a.set("restaurants-json",e)}),e}))})))})}});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL2lkYi9saWIvaWRiLmpzIiwid2VicGFjazovLy8uL3N3LmpzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwicHJvbWlzaWZ5UmVxdWVzdCIsInJlcXVlc3QiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm9uc3VjY2VzcyIsInJlc3VsdCIsIm9uZXJyb3IiLCJlcnJvciIsInByb21pc2lmeVJlcXVlc3RDYWxsIiwib2JqIiwibWV0aG9kIiwiYXJncyIsImFwcGx5IiwidGhlbiIsInByb3h5UHJvcGVydGllcyIsIlByb3h5Q2xhc3MiLCJ0YXJnZXRQcm9wIiwicHJvcGVydGllcyIsImZvckVhY2giLCJwcm9wIiwidGhpcyIsInNldCIsInZhbCIsInByb3h5UmVxdWVzdE1ldGhvZHMiLCJDb25zdHJ1Y3RvciIsImFyZ3VtZW50cyIsInByb3h5TWV0aG9kcyIsInByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMiLCJDdXJzb3IiLCJJbmRleCIsImluZGV4IiwiX2luZGV4IiwiY3Vyc29yIiwiX2N1cnNvciIsIl9yZXF1ZXN0IiwiT2JqZWN0U3RvcmUiLCJzdG9yZSIsIl9zdG9yZSIsIlRyYW5zYWN0aW9uIiwiaWRiVHJhbnNhY3Rpb24iLCJfdHgiLCJjb21wbGV0ZSIsIm9uY29tcGxldGUiLCJvbmFib3J0IiwiVXBncmFkZURCIiwiZGIiLCJvbGRWZXJzaW9uIiwidHJhbnNhY3Rpb24iLCJfZGIiLCJEQiIsIklEQkluZGV4IiwiSURCQ3Vyc29yIiwibWV0aG9kTmFtZSIsImNyZWF0ZUluZGV4IiwiSURCT2JqZWN0U3RvcmUiLCJvYmplY3RTdG9yZSIsIklEQlRyYW5zYWN0aW9uIiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJJREJEYXRhYmFzZSIsImZ1bmNOYW1lIiwicmVwbGFjZSIsImFyciIsIkFycmF5Iiwic2xpY2UiLCJjYWxsYmFjayIsImxlbmd0aCIsIm5hdGl2ZU9iamVjdCIsImdldEFsbCIsInF1ZXJ5IiwiY291bnQiLCJpbnN0YW5jZSIsIml0ZW1zIiwiaXRlcmF0ZUN1cnNvciIsInB1c2giLCJ1bmRlZmluZWQiLCJjb250aW51ZSIsImV4cCIsIm9wZW4iLCJ2ZXJzaW9uIiwidXBncmFkZUNhbGxiYWNrIiwiaW5kZXhlZERCIiwib251cGdyYWRlbmVlZGVkIiwiZXZlbnQiLCJkZWxldGUiLCJkZWZhdWx0IiwiY29udGVudEltZ3NDYWNoZSIsIm1hcENhY2hlIiwiYWxsQ2FjaGVzIiwiZmlsZXNBcnIiLCJkYlByb21pc2UiLCJhIiwidXBncmFkZURCIiwiaWRiUmVzdGF1cmFudHMiLCJ0eCIsInB1dCIsImNsZWFyIiwia2V5cyIsIml0ZXJhdGVLZXlDdXJzb3IiLCJzZWxmIiwiYWRkRXZlbnRMaXN0ZW5lciIsImNvbnNvbGUiLCJsb2ciLCJ3YWl0VW50aWwiLCJjYWNoZXMiLCJjYWNoZSIsImFkZEFsbCIsImNhdGNoIiwiZXJyIiwiY2FjaGVOYW1lcyIsImFsbCIsImZpbHRlciIsImNhY2hlTmFtZSIsInN0YXJ0c1dpdGgiLCJpbmNsdWRlcyIsIm1hcCIsInJlcXVlc3RVcmwiLCJVUkwiLCJ1cmwiLCJvcmlnaW4iLCJsb2NhdGlvbiIsInBhdGhuYW1lIiwicmVzcG9uZFdpdGgiLCJtYXRjaCIsInN0b3JhZ2VVcmwiLCJyZXNwb25zZSIsImZldGNoIiwibmV0d29ya1Jlc3BvbnNlIiwiY2xvbmUiLCJzZXJ2ZVBob3RvIiwicmVxdWVzdE1hcCIsIm1hcFJlc3BvbnNlIiwibmV0d29ya1Jlc3BvbnNlTWFwIiwicmVxdWVzdEpTT04iLCJSZXNwb25zZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJyZXMiLCJpbmRleFZhbHVlIiwianNvbiJdLCJtYXBwaW5ncyI6ImFBQ0EsSUFBQUEsS0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQUMsUUFHQSxJQUFBQyxFQUFBSixFQUFBRSxJQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFlBVUEsT0FOQUksRUFBQUwsR0FBQU0sS0FBQUosRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUYsR0FHQUcsRUFBQUUsR0FBQSxFQUdBRixFQUFBRCxRQUtBRixFQUFBUSxFQUFBRixFQUdBTixFQUFBUyxFQUFBVixFQUdBQyxFQUFBVSxFQUFBLFNBQUFSLEVBQUFTLEVBQUFDLEdBQ0FaLEVBQUFhLEVBQUFYLEVBQUFTLElBQ0FHLE9BQUFDLGVBQUFiLEVBQUFTLEdBQTBDSyxZQUFBLEVBQUFDLElBQUFMLEtBSzFDWixFQUFBa0IsRUFBQSxTQUFBaEIsR0FDQSxvQkFBQWlCLGVBQUFDLGFBQ0FOLE9BQUFDLGVBQUFiLEVBQUFpQixPQUFBQyxhQUF3REMsTUFBQSxXQUV4RFAsT0FBQUMsZUFBQWIsRUFBQSxjQUFpRG1CLE9BQUEsS0FRakRyQixFQUFBc0IsRUFBQSxTQUFBRCxFQUFBRSxHQUVBLEdBREEsRUFBQUEsSUFBQUYsRUFBQXJCLEVBQUFxQixJQUNBLEVBQUFFLEVBQUEsT0FBQUYsRUFDQSxLQUFBRSxHQUFBLGlCQUFBRixRQUFBRyxXQUFBLE9BQUFILEVBQ0EsSUFBQUksRUFBQVgsT0FBQVksT0FBQSxNQUdBLEdBRkExQixFQUFBa0IsRUFBQU8sR0FDQVgsT0FBQUMsZUFBQVUsRUFBQSxXQUF5Q1QsWUFBQSxFQUFBSyxVQUN6QyxFQUFB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QUNBd0IsTUFBQU8sR0FBQXZILEtBQUEsU0FBQTJILEdBQ0EsSUFBQUMsRUFBQUQsRUFBQVQsUUFPQSxPQUpBVSxFQUFBQyxPQUFBN0gsS0FBQSxTQUFBNkgsR0FDQTlDLEVBQUF2RSxJQUFBLG1CQUFBcUgsS0FHQUYiLCJmaWxlIjoic3cuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gOSk7XG4iLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbigpIHtcbiAgZnVuY3Rpb24gdG9BcnJheShhcnIpIHtcbiAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJyKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlc29sdmUocmVxdWVzdC5yZXN1bHQpO1xuICAgICAgfTtcblxuICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChyZXF1ZXN0LmVycm9yKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xuICAgIHZhciByZXF1ZXN0O1xuICAgIHZhciBwID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICByZXF1ZXN0ID0gb2JqW21ldGhvZF0uYXBwbHkob2JqLCBhcmdzKTtcbiAgICAgIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkudGhlbihyZXNvbHZlLCByZWplY3QpO1xuICAgIH0pO1xuXG4gICAgcC5yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgICByZXR1cm4gcDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeUN1cnNvclJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XG4gICAgdmFyIHAgPSBwcm9taXNpZnlSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncyk7XG4gICAgcmV0dXJuIHAudGhlbihmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xuICAgICAgcmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIHAucmVxdWVzdCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eVByb3BlcnRpZXMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUHJveHlDbGFzcy5wcm90b3R5cGUsIHByb3AsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gdGhpc1t0YXJnZXRQcm9wXVtwcm9wXTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbih2YWwpIHtcbiAgICAgICAgICB0aGlzW3RhcmdldFByb3BdW3Byb3BdID0gdmFsO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5UmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdENhbGwodGhpc1t0YXJnZXRQcm9wXSwgcHJvcCwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eU1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpc1t0YXJnZXRQcm9wXVtwcm9wXS5hcHBseSh0aGlzW3RhcmdldFByb3BdLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwodGhpc1t0YXJnZXRQcm9wXSwgcHJvcCwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBJbmRleChpbmRleCkge1xuICAgIHRoaXMuX2luZGV4ID0gaW5kZXg7XG4gIH1cblxuICBwcm94eVByb3BlcnRpZXMoSW5kZXgsICdfaW5kZXgnLCBbXG4gICAgJ25hbWUnLFxuICAgICdrZXlQYXRoJyxcbiAgICAnbXVsdGlFbnRyeScsXG4gICAgJ3VuaXF1ZSdcbiAgXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhJbmRleCwgJ19pbmRleCcsIElEQkluZGV4LCBbXG4gICAgJ2dldCcsXG4gICAgJ2dldEtleScsXG4gICAgJ2dldEFsbCcsXG4gICAgJ2dldEFsbEtleXMnLFxuICAgICdjb3VudCdcbiAgXSk7XG5cbiAgcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhJbmRleCwgJ19pbmRleCcsIElEQkluZGV4LCBbXG4gICAgJ29wZW5DdXJzb3InLFxuICAgICdvcGVuS2V5Q3Vyc29yJ1xuICBdKTtcblxuICBmdW5jdGlvbiBDdXJzb3IoY3Vyc29yLCByZXF1ZXN0KSB7XG4gICAgdGhpcy5fY3Vyc29yID0gY3Vyc29yO1xuICAgIHRoaXMuX3JlcXVlc3QgPSByZXF1ZXN0O1xuICB9XG5cbiAgcHJveHlQcm9wZXJ0aWVzKEN1cnNvciwgJ19jdXJzb3InLCBbXG4gICAgJ2RpcmVjdGlvbicsXG4gICAgJ2tleScsXG4gICAgJ3ByaW1hcnlLZXknLFxuICAgICd2YWx1ZSdcbiAgXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhDdXJzb3IsICdfY3Vyc29yJywgSURCQ3Vyc29yLCBbXG4gICAgJ3VwZGF0ZScsXG4gICAgJ2RlbGV0ZSdcbiAgXSk7XG5cbiAgLy8gcHJveHkgJ25leHQnIG1ldGhvZHNcbiAgWydhZHZhbmNlJywgJ2NvbnRpbnVlJywgJ2NvbnRpbnVlUHJpbWFyeUtleSddLmZvckVhY2goZnVuY3Rpb24obWV0aG9kTmFtZSkge1xuICAgIGlmICghKG1ldGhvZE5hbWUgaW4gSURCQ3Vyc29yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICBDdXJzb3IucHJvdG90eXBlW21ldGhvZE5hbWVdID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgY3Vyc29yID0gdGhpcztcbiAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgIGN1cnNvci5fY3Vyc29yW21ldGhvZE5hbWVdLmFwcGx5KGN1cnNvci5fY3Vyc29yLCBhcmdzKTtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3QoY3Vyc29yLl9yZXF1ZXN0KS50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xuICAgICAgICAgIHJldHVybiBuZXcgQ3Vyc29yKHZhbHVlLCBjdXJzb3IuX3JlcXVlc3QpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIE9iamVjdFN0b3JlKHN0b3JlKSB7XG4gICAgdGhpcy5fc3RvcmUgPSBzdG9yZTtcbiAgfVxuXG4gIE9iamVjdFN0b3JlLnByb3RvdHlwZS5jcmVhdGVJbmRleCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuY3JlYXRlSW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIE9iamVjdFN0b3JlLnByb3RvdHlwZS5pbmRleCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuaW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIFtcbiAgICAnbmFtZScsXG4gICAgJ2tleVBhdGgnLFxuICAgICdpbmRleE5hbWVzJyxcbiAgICAnYXV0b0luY3JlbWVudCdcbiAgXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXG4gICAgJ3B1dCcsXG4gICAgJ2FkZCcsXG4gICAgJ2RlbGV0ZScsXG4gICAgJ2NsZWFyJyxcbiAgICAnZ2V0JyxcbiAgICAnZ2V0QWxsJyxcbiAgICAnZ2V0S2V5JyxcbiAgICAnZ2V0QWxsS2V5cycsXG4gICAgJ2NvdW50J1xuICBdKTtcblxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAnb3BlbkN1cnNvcicsXG4gICAgJ29wZW5LZXlDdXJzb3InXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXG4gICAgJ2RlbGV0ZUluZGV4J1xuICBdKTtcblxuICBmdW5jdGlvbiBUcmFuc2FjdGlvbihpZGJUcmFuc2FjdGlvbikge1xuICAgIHRoaXMuX3R4ID0gaWRiVHJhbnNhY3Rpb247XG4gICAgdGhpcy5jb21wbGV0ZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25jb21wbGV0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXNvbHZlKCk7XG4gICAgICB9O1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QoaWRiVHJhbnNhY3Rpb24uZXJyb3IpO1xuICAgICAgfTtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uYWJvcnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBUcmFuc2FjdGlvbi5wcm90b3R5cGUub2JqZWN0U3RvcmUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IE9iamVjdFN0b3JlKHRoaXMuX3R4Lm9iamVjdFN0b3JlLmFwcGx5KHRoaXMuX3R4LCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoVHJhbnNhY3Rpb24sICdfdHgnLCBbXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnLFxuICAgICdtb2RlJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoVHJhbnNhY3Rpb24sICdfdHgnLCBJREJUcmFuc2FjdGlvbiwgW1xuICAgICdhYm9ydCdcbiAgXSk7XG5cbiAgZnVuY3Rpb24gVXBncmFkZURCKGRiLCBvbGRWZXJzaW9uLCB0cmFuc2FjdGlvbikge1xuICAgIHRoaXMuX2RiID0gZGI7XG4gICAgdGhpcy5vbGRWZXJzaW9uID0gb2xkVmVyc2lvbjtcbiAgICB0aGlzLnRyYW5zYWN0aW9uID0gbmV3IFRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uKTtcbiAgfVxuXG4gIFVwZ3JhZGVEQi5wcm90b3R5cGUuY3JlYXRlT2JqZWN0U3RvcmUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IE9iamVjdFN0b3JlKHRoaXMuX2RiLmNyZWF0ZU9iamVjdFN0b3JlLmFwcGx5KHRoaXMuX2RiLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoVXBncmFkZURCLCAnX2RiJywgW1xuICAgICduYW1lJyxcbiAgICAndmVyc2lvbicsXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhVcGdyYWRlREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xuICAgICdkZWxldGVPYmplY3RTdG9yZScsXG4gICAgJ2Nsb3NlJ1xuICBdKTtcblxuICBmdW5jdGlvbiBEQihkYikge1xuICAgIHRoaXMuX2RiID0gZGI7XG4gIH1cblxuICBEQi5wcm90b3R5cGUudHJhbnNhY3Rpb24gPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IFRyYW5zYWN0aW9uKHRoaXMuX2RiLnRyYW5zYWN0aW9uLmFwcGx5KHRoaXMuX2RiLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoREIsICdfZGInLCBbXG4gICAgJ25hbWUnLFxuICAgICd2ZXJzaW9uJyxcbiAgICAnb2JqZWN0U3RvcmVOYW1lcydcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKERCLCAnX2RiJywgSURCRGF0YWJhc2UsIFtcbiAgICAnY2xvc2UnXG4gIF0pO1xuXG4gIC8vIEFkZCBjdXJzb3IgaXRlcmF0b3JzXG4gIC8vIFRPRE86IHJlbW92ZSB0aGlzIG9uY2UgYnJvd3NlcnMgZG8gdGhlIHJpZ2h0IHRoaW5nIHdpdGggcHJvbWlzZXNcbiAgWydvcGVuQ3Vyc29yJywgJ29wZW5LZXlDdXJzb3InXS5mb3JFYWNoKGZ1bmN0aW9uKGZ1bmNOYW1lKSB7XG4gICAgW09iamVjdFN0b3JlLCBJbmRleF0uZm9yRWFjaChmdW5jdGlvbihDb25zdHJ1Y3Rvcikge1xuICAgICAgLy8gRG9uJ3QgY3JlYXRlIGl0ZXJhdGVLZXlDdXJzb3IgaWYgb3BlbktleUN1cnNvciBkb2Vzbid0IGV4aXN0LlxuICAgICAgaWYgKCEoZnVuY05hbWUgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuXG4gICAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGVbZnVuY05hbWUucmVwbGFjZSgnb3BlbicsICdpdGVyYXRlJyldID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBhcmdzID0gdG9BcnJheShhcmd1bWVudHMpO1xuICAgICAgICB2YXIgY2FsbGJhY2sgPSBhcmdzW2FyZ3MubGVuZ3RoIC0gMV07XG4gICAgICAgIHZhciBuYXRpdmVPYmplY3QgPSB0aGlzLl9zdG9yZSB8fCB0aGlzLl9pbmRleDtcbiAgICAgICAgdmFyIHJlcXVlc3QgPSBuYXRpdmVPYmplY3RbZnVuY05hbWVdLmFwcGx5KG5hdGl2ZU9iamVjdCwgYXJncy5zbGljZSgwLCAtMSkpO1xuICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGNhbGxiYWNrKHJlcXVlc3QucmVzdWx0KTtcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vIHBvbHlmaWxsIGdldEFsbFxuICBbSW5kZXgsIE9iamVjdFN0b3JlXS5mb3JFYWNoKGZ1bmN0aW9uKENvbnN0cnVjdG9yKSB7XG4gICAgaWYgKENvbnN0cnVjdG9yLnByb3RvdHlwZS5nZXRBbGwpIHJldHVybjtcbiAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsID0gZnVuY3Rpb24ocXVlcnksIGNvdW50KSB7XG4gICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xuICAgICAgdmFyIGl0ZW1zID0gW107XG5cbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlKSB7XG4gICAgICAgIGluc3RhbmNlLml0ZXJhdGVDdXJzb3IocXVlcnksIGZ1bmN0aW9uKGN1cnNvcikge1xuICAgICAgICAgIGlmICghY3Vyc29yKSB7XG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaXRlbXMucHVzaChjdXJzb3IudmFsdWUpO1xuXG4gICAgICAgICAgaWYgKGNvdW50ICE9PSB1bmRlZmluZWQgJiYgaXRlbXMubGVuZ3RoID09IGNvdW50KSB7XG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSk7XG5cbiAgdmFyIGV4cCA9IHtcbiAgICBvcGVuOiBmdW5jdGlvbihuYW1lLCB2ZXJzaW9uLCB1cGdyYWRlQ2FsbGJhY2spIHtcbiAgICAgIHZhciBwID0gcHJvbWlzaWZ5UmVxdWVzdENhbGwoaW5kZXhlZERCLCAnb3BlbicsIFtuYW1lLCB2ZXJzaW9uXSk7XG4gICAgICB2YXIgcmVxdWVzdCA9IHAucmVxdWVzdDtcblxuICAgICAgaWYgKHJlcXVlc3QpIHtcbiAgICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgIGlmICh1cGdyYWRlQ2FsbGJhY2spIHtcbiAgICAgICAgICAgIHVwZ3JhZGVDYWxsYmFjayhuZXcgVXBncmFkZURCKHJlcXVlc3QucmVzdWx0LCBldmVudC5vbGRWZXJzaW9uLCByZXF1ZXN0LnRyYW5zYWN0aW9uKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uKGRiKSB7XG4gICAgICAgIHJldHVybiBuZXcgREIoZGIpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBkZWxldGU6IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdkZWxldGVEYXRhYmFzZScsIFtuYW1lXSk7XG4gICAgfVxuICB9O1xuXG4gIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZXhwO1xuICAgIG1vZHVsZS5leHBvcnRzLmRlZmF1bHQgPSBtb2R1bGUuZXhwb3J0cztcbiAgfVxuICBlbHNlIHtcbiAgICBzZWxmLmlkYiA9IGV4cDtcbiAgfVxufSgpKTtcbiIsImltcG9ydCBpZGIgZnJvbSAnaWRiJztcblxuY29uc3Qgc3RhdGljQ2FjaGVOYW1lID0gJ3Jlc3RhdXJhbnQtcmV2aWV3cy12MSc7XG5jb25zdCBjb250ZW50SW1nc0NhY2hlID0gJ3Jlc3RhdXJhbnQtaW1hZ2VzLXYxJztcbmNvbnN0IG1hcENhY2hlID0gJ3Jlc3RhdXJhbnQtbWFwLXYxJztcbmNvbnN0IGFsbENhY2hlcyA9IFtzdGF0aWNDYWNoZU5hbWUsIGNvbnRlbnRJbWdzQ2FjaGUsIG1hcENhY2hlXTtcbmNvbnN0IGZpbGVzQXJyID0gW1xuXHQnL2luZGV4Lmh0bWwnLFxuXHQnL3Jlc3RhdXJhbnQuaHRtbCcsXG5cdCcvcmVzdGF1cmFudC5idW5kbGUuanMnLFxuXHQnL21haW4uYnVuZGxlLmpzJ1xuXTtcblxudmFyIGRiUHJvbWlzZSA9IGlkYi5vcGVuKCdyZXN0YXVyYW50LXJldmlld3MnLCAxLCBmdW5jdGlvbih1cGdyYWRlREIpIHtcblx0dXBncmFkZURCLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpO1xufSk7XG5cbmNvbnN0IGlkYlJlc3RhdXJhbnRzID0ge1xuXHRnZXQoa2V5KSB7XG5cdFx0cmV0dXJuIGRiUHJvbWlzZS50aGVuKGRiID0+IHtcblx0XHRcdHJldHVybiBkYlxuXHRcdFx0XHQudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJylcblx0XHRcdFx0Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpXG5cdFx0XHRcdC5nZXQoa2V5KTtcblx0XHR9KTtcblx0fSxcblx0c2V0KGtleSwgdmFsKSB7XG5cdFx0cmV0dXJuIGRiUHJvbWlzZS50aGVuKGRiID0+IHtcblx0XHRcdGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJywgJ3JlYWR3cml0ZScpO1xuXHRcdFx0dHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJykucHV0KHZhbCwga2V5KTtcblx0XHRcdHJldHVybiB0eC5jb21wbGV0ZTtcblx0XHR9KTtcblx0fSxcblx0ZGVsZXRlKGtleSkge1xuXHRcdHJldHVybiBkYlByb21pc2UudGhlbihkYiA9PiB7XG5cdFx0XHRjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycsICdyZWFkd3JpdGUnKTtcblx0XHRcdHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpLmRlbGV0ZShrZXkpO1xuXHRcdFx0cmV0dXJuIHR4LmNvbXBsZXRlO1xuXHRcdH0pO1xuXHR9LFxuXHRjbGVhcigpIHtcblx0XHRyZXR1cm4gZGJQcm9taXNlLnRoZW4oZGIgPT4ge1xuXHRcdFx0Y29uc3QgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZHdyaXRlJyk7XG5cdFx0XHR0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKS5jbGVhcigpO1xuXHRcdFx0cmV0dXJuIHR4LmNvbXBsZXRlO1xuXHRcdH0pO1xuXHR9LFxuXHRrZXlzKCkge1xuXHRcdHJldHVybiBkYlByb21pc2UudGhlbihkYiA9PiB7XG5cdFx0XHRjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycpO1xuXHRcdFx0Y29uc3Qga2V5cyA9IFtdO1xuXHRcdFx0Y29uc3Qgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKTtcblxuXHRcdFx0Ly8gVGhpcyB3b3VsZCBiZSBzdG9yZS5nZXRBbGxLZXlzKCksIGJ1dCBpdCBpc24ndCBzdXBwb3J0ZWQgYnkgRWRnZSBvciBTYWZhcmkuXG5cdFx0XHQvLyBvcGVuS2V5Q3Vyc29yIGlzbid0IHN1cHBvcnRlZCBieSBTYWZhcmksIHNvIHdlIGZhbGwgYmFja1xuXHRcdFx0KHN0b3JlLml0ZXJhdGVLZXlDdXJzb3IgfHwgc3RvcmUuaXRlcmF0ZUN1cnNvcikuY2FsbChzdG9yZSwgY3Vyc29yID0+IHtcblx0XHRcdFx0aWYgKCFjdXJzb3IpIHJldHVybjtcblx0XHRcdFx0a2V5cy5wdXNoKGN1cnNvci5rZXkpO1xuXHRcdFx0XHRjdXJzb3IuY29udGludWUoKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRyZXR1cm4gdHguY29tcGxldGUudGhlbigoKSA9PiBrZXlzKTtcblx0XHR9KTtcblx0fVxufTtcblxuc2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZnVuY3Rpb24oZXZlbnQpIHtcblx0Y29uc29sZS5sb2coJ1NlcnZpY2VXb3JrZXIgaW5zdGFsbGVkJyk7XG5cdGV2ZW50LndhaXRVbnRpbChcblx0XHRjYWNoZXNcblx0XHRcdC5vcGVuKHN0YXRpY0NhY2hlTmFtZSlcblx0XHRcdC50aGVuKGZ1bmN0aW9uKGNhY2hlKSB7XG5cdFx0XHRcdHJldHVybiBjYWNoZS5hZGRBbGwoZmlsZXNBcnIpO1xuXHRcdFx0fSlcblx0XHRcdC5jYXRjaChmdW5jdGlvbihlcnIpIHtcblx0XHRcdFx0Y29uc29sZS5sb2coJ0Vycm9yIGhhcyBvY2N1cmVkOiAnLCBlcnIpO1xuXHRcdFx0fSlcblx0KTtcbn0pO1xuXG5zZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2FjdGl2YXRlJywgZnVuY3Rpb24oZXZlbnQpIHtcblx0ZXZlbnQud2FpdFVudGlsKFxuXHRcdGNhY2hlcy5rZXlzKCkudGhlbihmdW5jdGlvbihjYWNoZU5hbWVzKSB7XG5cdFx0XHRyZXR1cm4gUHJvbWlzZS5hbGwoXG5cdFx0XHRcdGNhY2hlTmFtZXNcblx0XHRcdFx0XHQuZmlsdGVyKGZ1bmN0aW9uKGNhY2hlTmFtZSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIChcblx0XHRcdFx0XHRcdFx0Y2FjaGVOYW1lLnN0YXJ0c1dpdGgoJ3Jlc3RhdXJhbnQtJykgJiZcblx0XHRcdFx0XHRcdFx0IWFsbENhY2hlcy5pbmNsdWRlcyhjYWNoZU5hbWUpXG5cdFx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0Lm1hcChmdW5jdGlvbihjYWNoZU5hbWUpIHtcblx0XHRcdFx0XHRcdHJldHVybiBjYWNoZXMuZGVsZXRlKGNhY2hlTmFtZSk7XG5cdFx0XHRcdFx0fSlcblx0XHRcdCk7XG5cdFx0fSlcblx0KTtcbn0pO1xuXG5zZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2ZldGNoJywgZnVuY3Rpb24oZXZlbnQpIHtcblx0bGV0IHJlcXVlc3RVcmwgPSBuZXcgVVJMKGV2ZW50LnJlcXVlc3QudXJsKTtcblxuXHQvLyBDaGVjayBmb3IgcmVxdWVzdHMgbWFkZSB0byBhcHAgYW5kIGFyZSBzcGVjaWFsIGNhc2VzXG5cdGlmIChyZXF1ZXN0VXJsLm9yaWdpbiA9PT0gbG9jYXRpb24ub3JpZ2luKSB7XG5cdFx0aWYgKHJlcXVlc3RVcmwucGF0aG5hbWUgPT09ICcvJykge1xuXHRcdFx0Y29uc29sZS5sb2coJ1NlcnZpbmcgY2FjaGVkIGluZGV4IHBhZ2UnKTtcblx0XHRcdGV2ZW50LnJlc3BvbmRXaXRoKGNhY2hlcy5tYXRjaCgnL2luZGV4Lmh0bWwnKSk7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0aWYgKHJlcXVlc3RVcmwucGF0aG5hbWUgPT09ICcvcmVzdGF1cmFudC5odG1sJykge1xuXHRcdFx0Ly8gVVJMIHBhcmFtcyBzdGF5IGludGFjdFxuXHRcdFx0Y29uc29sZS5sb2coJ1NlcnZpbmcgcmVzdHJhdW50IHBhZ2UnKTtcblx0XHRcdGV2ZW50LnJlc3BvbmRXaXRoKGNhY2hlcy5tYXRjaCgnL3Jlc3RhdXJhbnQuaHRtbCcpKTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHQvLyBDaGVjayBmb3IgaW1hZ2VzIHRvIHNlcnZlXG5cdFx0aWYgKHJlcXVlc3RVcmwucGF0aG5hbWUuc3RhcnRzV2l0aCgnL2ltZy8nKSkge1xuXHRcdFx0Y29uc29sZS5sb2coJ0ltYWdlIHJlcXVlc3RlZCwgY2hlY2tpbmcgY2FjaGUnKTtcblx0XHRcdGV2ZW50LnJlc3BvbmRXaXRoKHNlcnZlUGhvdG8oZXZlbnQucmVxdWVzdCkpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdC8vIENoZWNrIGZvciBtYXBcblx0XHRpZiAocmVxdWVzdFVybC5wYXRobmFtZS5zdGFydHNXaXRoKCcvbWFwcy9hcGkvanMnKSkge1xuXHRcdFx0Y29uc29sZS5sb2coJ01hcCByZXF1ZXN0ZWQsIGNoZWNraW5nIGNhY2hlJyk7XG5cdFx0XHRldmVudC5yZXNwb25kV2l0aChzZXJ2ZU1hcChldmVudC5yZXF1ZXN0KSk7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHR9XG5cblx0Ly8gUmVzdHVyYW50cyBKU09OXG5cdGlmIChyZXF1ZXN0VXJsLnBhdGhuYW1lID09PSAnL3Jlc3RhdXJhbnRzJykge1xuXHRcdGV2ZW50LnJlc3BvbmRXaXRoKHNlcnZlUmVzdGF1cmFudHNKU09OKGV2ZW50LnJlcXVlc3QpKTtcblx0XHRyZXR1cm47XG5cdH1cblxuXHQvLyBDYXRjaCBhbGwgY2FjaGUgZXh0ZXJuYWwgcmVzcG9uc2VzXG5cdGV2ZW50LnJlc3BvbmRXaXRoKFxuXHRcdGNhY2hlcy5tYXRjaChldmVudC5yZXF1ZXN0KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cdFx0XHRyZXR1cm4gcmVzcG9uc2UgfHwgZmV0Y2goZXZlbnQucmVxdWVzdCk7XG5cdFx0fSlcblx0KTtcbn0pO1xuXG5mdW5jdGlvbiBzZXJ2ZVBob3RvKHJlcXVlc3QpIHtcblx0Ly8gVXBkYXRlIHRvIHVzZXIgZnJpZW5kbHkgbmFtZVxuXHRjb25zdCBzdG9yYWdlVXJsID0gcmVxdWVzdC51cmwucmVwbGFjZSgvLVxcZCtweFxcLmpwZyQvLCAnJyk7XG5cblx0Ly8gQWRkIGltYWdlIHRvIGNhY2hlIGFuZCBzZXJ2ZSBpbWFnZSBpZiBpbiBjYWNoZVxuXHRyZXR1cm4gY2FjaGVzLm9wZW4oY29udGVudEltZ3NDYWNoZSkudGhlbihmdW5jdGlvbihjYWNoZSkge1xuXHRcdHJldHVybiBjYWNoZS5tYXRjaChzdG9yYWdlVXJsKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cdFx0XHRpZiAocmVzcG9uc2UpIHJldHVybiByZXNwb25zZTtcblxuXHRcdFx0cmV0dXJuIGZldGNoKHJlcXVlc3QpLnRoZW4oZnVuY3Rpb24obmV0d29ya1Jlc3BvbnNlKSB7XG5cdFx0XHRcdGNhY2hlLnB1dChzdG9yYWdlVXJsLCBuZXR3b3JrUmVzcG9uc2UuY2xvbmUoKSk7XG5cdFx0XHRcdHJldHVybiBuZXR3b3JrUmVzcG9uc2U7XG5cdFx0XHR9KTtcblx0XHR9KTtcblx0fSk7XG59XG5cbmZ1bmN0aW9uIHNlcnZlTWFwKHJlcXVlc3RNYXApIHtcblx0Ly8gSSB3b25kZXIgd2hhdCBpdCdzIHJlc3BvbnNlIHR5cGUgaXM/XG5cdGNvbnN0IG1hcE5hbWUgPSAnbWFwJztcblxuXHRyZXR1cm4gY2FjaGVzLm9wZW4obWFwQ2FjaGUpLnRoZW4oZnVuY3Rpb24oY2FjaGUpIHtcblx0XHRyZXR1cm4gY2FjaGUubWF0Y2gobWFwTmFtZSkudGhlbihmdW5jdGlvbihtYXBSZXNwb25zZSkge1xuXHRcdFx0Ly8gSWYgdGhlcmUgaXMgYSBtYXAgaW4gdGhlIGNhY2hlIHJlc3BvbmQgd2l0aCBpdFxuXHRcdFx0aWYgKG1hcFJlc3BvbnNlKSByZXR1cm4gbWFwUmVzcG9uc2U7XG5cblx0XHRcdC8vIEdldCBtYXAgdGhlbiBjYWNoZSBhbmQgc2VydmUgaXRcblx0XHRcdHJldHVybiBmZXRjaChyZXF1ZXN0TWFwLCB7IG1vZGU6ICduby1jb3JzJyB9KS50aGVuKGZ1bmN0aW9uKFxuXHRcdFx0XHRuZXR3b3JrUmVzcG9uc2VNYXBcblx0XHRcdCkge1xuXHRcdFx0XHRjYWNoZS5wdXQobWFwTmFtZSwgbmV0d29ya1Jlc3BvbnNlTWFwLmNsb25lKCkpO1xuXHRcdFx0XHRyZXR1cm4gbmV0d29ya1Jlc3BvbnNlTWFwO1xuXHRcdFx0fSk7XG5cdFx0fSk7XG5cdH0pO1xufVxuXG5mdW5jdGlvbiBzZXJ2ZVJlc3RhdXJhbnRzSlNPTihyZXF1ZXN0SlNPTikge1xuXHRyZXR1cm4gaWRiUmVzdGF1cmFudHMuZ2V0KCdyZXN0YXVyYW50cy1qc29uJykudGhlbihmdW5jdGlvbih2YWwpIHtcblx0XHRpZiAodmFsKSB7XG5cdFx0XHRjb25zb2xlLmxvZygnSW5kZXhEQiBKU09OIEZvdW5kJylcblx0XHRcdHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkodmFsKSk7XG5cdFx0fVxuXG5cdFx0Y29uc29sZS5sb2coJ0luZGV4REIgRW1wdHkgUmV0dXJuaW5nIEZldGNoJyk7XG5cdFx0cmV0dXJuIGZldGNoKHJlcXVlc3RKU09OKS50aGVuKGZ1bmN0aW9uKHJlcykge1xuXHRcdFx0bGV0IGluZGV4VmFsdWUgPSByZXMuY2xvbmUoKTtcblx0XHRcdFxuXHRcdFx0Ly8gUHV0IEpTT04gaW4gaW5kZXhlZERCXG5cdFx0XHRpbmRleFZhbHVlLmpzb24oKS50aGVuKGZ1bmN0aW9uKGpzb24pIHtcblx0XHRcdFx0aWRiUmVzdGF1cmFudHMuc2V0KCdyZXN0YXVyYW50cy1qc29uJywganNvbik7XG5cdFx0XHR9KTtcblx0XHRcdFxuXHRcdFx0cmV0dXJuIHJlcztcblx0XHR9KTtcblx0fSk7XG59XG4iXSwic291cmNlUm9vdCI6IiJ9